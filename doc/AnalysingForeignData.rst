.. _analysingforeigndata:

Analysing data not generated by PYMEAcquire
*******************************************

There are two key aspects to analysing data not generated by PYME - getting the
data into a format that PYME understands, and filling in the required metadata entries.

Getting data into a PYME format
===============================

There are two ways of doing this:

Converting the data to ``.h5`` (old method)
+++++++++++++++++++++++++++++++++++++++++++

There are a number of scripts to convert different data types (currently Raw, Tiff
sequences, kdf stacks, and sequences of kdfs) to ``.h5`` in the ``PYME.FileUtils``
folder. This approach is relatively well tested, if a little inelegant. It also has 
the advantage of giving you data compression.

Directly analysing the data (new method)
++++++++++++++++++++++++++++++++++++++++

The latest version of PYME includes support for analysing directly from tiff stacks
with the intention of extending this to raw and possibly other formats (eg ``.sif``).
This is largely untested. It also won't play well with distributed/cluster analysis
unless you have the data directory mounted and the relevant environment variable set.

Fixing the metadata
===================

In order to establish an accurate noise model for fitting and event detection, PYME
needs to know several properties of the camera as well as the image pixel size.
After converting and loading the data one thus needs to tweak the metadata (using
the **Metadata** tab) of PYMEAcquire. Missing entries need to be added in the command
window by executing::

   image.mdh['entryname'] = value

Unfortunately these changes don't persist (following the rational that raw data
should be immutable) and will need to be re-entered each time you load and analyse
the data.

If using the direct method, however, you can place a ``.md`` file in the same directory
as your data and with the same base filename and put your metadata entries in there.
This file should consist of a number of lines having the syntax::

   md['entryname'] = value

The metadata entries are heirachial and use a dot notation (eg ``Camera.ADOffset``)

Required Entries
++++++++++++++++

An absolute minimum set of metadata parameters is outlined below:

========================  ============================================================
Name                      Description
========================  ============================================================
voxelsize.x               x pixel size in μm
voxelsize.y               y pixel size in μm
Camera.TrueEMGain         The calibrated electron multiplying gain (1 for
                          ordinary CCDs)
Camera.NoiseFactor        EM excess noise factor (1.41 for EMCCDs, 1 for
                          standard CCDs / sCMOS)
Camera.ElectronsPerCount  Number of photo-electons per AD unit
Camera.ReadNoise          Read out noise in photo-electrons
Camera.ADOffset           Analog to digital offset (dark level). Not strictly
                          required as PYME will try and guess this from dark frames
                          at the beginning of the sequence, but unless your acquistion
                          is a very good match to the PYMEAcquire protocols this is
                          unlikely to work well.
========================  ============================================================