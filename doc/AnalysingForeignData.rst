.. _analysingforeigndata:

Analysing data not generated by PYMEAcquire
*******************************************

There are two key aspects to analysing data not generated by PYME - getting the
data into a format that PYME understands, and filling in the required metadata entries.

There are two principle ways of doing this:

Converting the data to PYMEs native ``.h5`` (old method)
========================================================

There are a number of scripts to convert different data types (currently Raw, Tiff
sequences, kdf stacks, and sequences of kdfs) to ``.h5`` in the ``PYME.FileUtils``
folder. This approach is a little inelegant but can be useful in some circumstances
and has the advantage of giving you data compression.

Directly analysing the data (reccomended method)
================================================

PYME also supports analysing directly from tiff stacks (all time points in one file)
and from sequences of individual tiffs (each frame is a seperate file). The caveat 
here is that it won't play well with distributed/cluster analysis unless the 
data is accessible on all the machines in the cluster (i.e. you have the 
directory containing the data mounted as mapped drive on each machine and 
the ``PYMEDATADIR`` environment variable set to point to this drive/ a sub-directory
therof).

As ``dh5view`` defaults to *blob* mode for ``.tif`` files, you might want to use the
command line mode option to force the localisation microscopy mode ie::

 dh5view -m LM filename.tif

I'd also recommend adding a ``filename.md`` metadata file (see below).

Fixing the metadata
===================

In order to establish an accurate noise model for fitting and event detection, PYME
needs to know several properties of the camera as well as the image pixel size.
After converting and loading the data one thus needs to tweak the metadata (using
the **Metadata** tab) of PYMEAcquire. Missing entries need to be added in the command
window by executing::

   image.mdh['entryname'] = value

Unfortunately these changes don't persist (following the rational that raw data
should be immutable) and will need to be re-entered each time you load and analyse
the data.

If using the direct method, however, you can place a ``.md`` file in the same directory
as your data and with the same base filename and put your metadata entries in there.
This file should consist of a number of lines having the syntax::

   md['entryname'] = value

The metadata entries are heirachial and use a dot notation (eg ``Camera.ADOffset``)

Required Entries
++++++++++++++++

An absolute minimum set of metadata parameters is outlined below:

========================  ============================================================
Name                      Description
========================  ============================================================
voxelsize.x               x pixel size in μm
voxelsize.y               y pixel size in μm
Camera.TrueEMGain         The calibrated electron multiplying gain (1 for
                          ordinary CCDs)
Camera.NoiseFactor        EM excess noise factor (1.41 for EMCCDs, 1 for
                          standard CCDs / sCMOS)
Camera.ElectronsPerCount  Number of photo-electons per AD unit
Camera.ReadNoise          Read out noise in photo-electrons
Camera.ADOffset           Analog to digital offset (dark level). Not strictly
                          required as PYME will try and guess this from dark frames
                          at the beginning of the sequence, but unless your acquistion
                          is a very good match to the PYMEAcquire protocols this is
                          unlikely to work well.
========================  ============================================================