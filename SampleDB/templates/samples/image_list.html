
{% load extra_filters %}
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
    <title>PYME Sample Information - Image Index</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="content-style-type" content="text/css">

    <script src="{{MEDIA_URL}}javascript/prototype.js" type="text/javascript"></script>
 <script src="{{MEDIA_URL}}javascript/scriptaculous.js" type="text/javascript"></script>
  
  <style>
    body {
        font-family: arial, helvetica, sans-serif;
    }

    tr.odd{
        background-color: #B4C9FC;
    }

    tr.even{
        background-color: #94A9FC;
    }

    span.user, span.user_active, span.tag, span.tag_active{
        margin: 1px;
        padding: 1px;
        border-style: solid;
        border-width: 1px;
        border-bottom-left-radius: 3px 3px;
        border-bottom-right-radius: 3px 3px;
        border-top-left-radius: 3px 3px;
        border-top-right-radius: 3px 3px;
        display: inline-block;
    }

    span.user{
        {%if user_info|sum:"disp"%}
        background-color: #8489AC;
        {%else%}
        background-color: #D4D9FC;
        {%endif%}
    }

    span.tag{
        {%if tag_info|sum:"disp"%}
        background-color: #8489AC;
        {%else%}
        background-color: #D4D9FC;
        {%endif%}
    }

    span.user_active, span.tag_active{
        background-color: #D4D9FC;
    }




    div.slider { width:1000px; margin:10px 0; background-color:#ccc; height:10px; position: relative; }
    div.slider div.handle { width:10px; height:11px; background-color:#f00; cursor:move; position: absolute; }

    div.filter {
        background-color: #B4F9BC;
        padding: 1px;
    }





</style>
</head>
  <body>
    <h3>Images</h3>
    

    <div class="filter">
    <form action="/images/" method="get">
        
    <p>
        <b>User:</b>
    {%for ui in user_info%}
        <span class="user{%if ui.disp%}_active{%endif%}">
        <label for="user_{{ui.name}}">{{ui.name}}</label><input type="checkbox" name="user_{{ui.name}}" id="user_{{ui.name}}" value="1" {%if ui.disp%} checked="checked"{%endif%}/>
        </span>
    {%endfor%}
    </p>
    <p>
        <table>
            <tr>
        <td><b>Date:</b></td>
        <td>
        <img src="/datehist/?{{query}}"/><br>
        
        <div id="date_slider" class="slider">
        <div class="handle" style="background-color: #0A0;"></div>
        <div class="handle" style="background-color: #0A0;"></div>
        </div>
        <label for="start_date">Start</label>
        <input type="text" name="start_date" id="start_date" value="{{start_date|date:"d/m/Y"}}"/>
        <label for="end_date">End</label>
        <input type="text" name="end_date" id="end_date" value="{{end_date|date:"d/m/Y"}}"/>
        <input type="button" value="Clear" onclick="$('start_date').value='none';$('end_date').value='none';"/>
        </td>
        </tr>
        </table>
    </p>
        <table>
            <tr>
            <td><b>Tags:</b></td>
            <td>
            {%for tag in tag_info%}
            <span class="tag{%if tag.disp%}_active{%endif%}">
            <label for="tag__{{tag.name}}">{{tag.name}}</label><input type="checkbox" name="tag__{{tag.name}}" id="tag__{{tag.name}}" value="1" {%if tag.disp%} checked="checked"{%endif%}/>
            </span>
            
            {%endfor%}
            </td>
            </tr>
        </table>

        <input type="submit" value="Apply Filter" />
    </form>

    <script type="text/javascript">
  (function() {
    var date_slider = $('date_slider');
    var start_d = new Date({{start_date.year}}, {{start_date.month}}, {{start_date.day}}, 0, 0, 0, 0);
    var end_d = new Date({{end_date.year}}, {{end_date.month}}, {{end_date.day}}, 0, 0, 0);

    new Control.Slider(date_slider.select('.handle'), date_slider, {
      range: $R(0, 1.),
      sliderValue: [0,1.],
      onSlide: function(value) {
        //box.setStyle({ width: value + 'px', height: value + 'px' });
        var new_s = new Date(start_d.getTime() + value[0]*(end_d.getTime() - start_d.getTime()));
        var new_e = new Date(start_d.getTime() + value[1]*(end_d.getTime() - start_d.getTime()));
        $('start_date').value = new_s.getDate() + '/' + (new_s.getMonth() + 1) + '/' + new_s.getFullYear();
        $('end_date').value = new_e.getDate() + '/' + (new_e.getMonth() + 1) + '/' + new_e.getFullYear();
      },
      onChange: function(value) {
        var new_s = new Date(start_d.getTime() + value[0]*(end_d.getTime() - start_d.getTime()));
        var new_e = new Date(start_d.getTime() + value[1]*(end_d.getTime() - start_d.getTime()));
        $('start_date').value = new_s.getDate() + '/' + (new_s.getMonth() + 1) + '/' + new_s.getFullYear();
        $('end_date').value = new_e.getDate() + '/' + (new_e.getMonth() + 1) + '/' + new_e.getFullYear();
      }
    });

    
  })();
  </script>
    </div>

    <p>Displaying results {{startNum}} to {{endNum}} of {{totalNum}}</p>
    <table>
    <thead>
    <tr><th>ID</th><th>Date</th><th>Files</th><th>Tags</th></tr>
    </thead>
    {% for im in object_list|dictsort:"timestamp" %}
    {#<tr class="{% cycle 'odd' 'even' %}">#}
    <tr class="{{im.timestamp.date|is_changed}}">
    <td><a href="/images/{{ im.imageID }}">{{im.imageID}}</a></td>
    <td>{{im.timestamp.date|date:"d/m/y"}}</td>
    <td>
    {%for f in im.files.all %}
    {{f.filename}}<br>
    {%endfor%}
    </td>
    <td>
    {%for t in im.tags.all %}
    {{t.tag}},
    {%endfor%}
    {%for f in im.files.all %}
    {%for t in f.tags.all %}
    {{t.tag}}, 
    {%endfor%}
    {%endfor%}
    </td>
    </tr>
    {% endfor %}
    </table>



  </body>
</html>